{% extends "base.html" %}

{% block content %}
<div class="slang-facts-page">
  <h1>Interesting Facts About {{ region_name }} Slang</h1>
  <p class="slang-subtitle">Share and discover interesting facts about slang in {{ region_name }}</p>

  <!-- Form to add new fact -->
  <div class="fact-form-card">
    <h2>Add New Fact</h2>
    <form method="POST" action="{{ url_for('slang_facts', region=region) }}">
      <div class="input-group">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required placeholder="Enter fact title...">
      </div>
      <div class="input-group">
        <label for="content">Content:</label>
        <textarea id="content" name="content" required rows="6" placeholder="Write your interesting fact about slang here..."></textarea>
      </div>
      <button type="submit" class="auth-btn">Add Fact</button>
    </form>
  </div>

  <!-- Display existing facts -->
  <div class="facts-list">
    <h2>All Facts ({{ facts|length }})</h2>
    
    {% if facts %}
      {% set system_facts = facts | selectattr("is_system") | list %}
      {% set user_facts = facts | rejectattr("is_system") | list %}
      
      {% if system_facts %}
        <h3 class="facts-section-title">System Facts</h3>
        {% for fact in system_facts %}
        <div class="fact-card {% if fact.is_system %}system-fact{% endif %}">
          <div class="fact-header">
            <h3>
              {{ fact.title }}
              {% if fact.is_system %}
                <span class="system-badge">System</span>
              {% endif %}
            </h3>
            {% if not fact.is_system and fact.user_id == session.get("user_id") %}
              <div class="fact-actions">
                <a href="{{ url_for('edit_slang_fact', region=region, fact_id=fact.id) }}" class="edit-btn">Edit</a>
                <form method="POST" action="{{ url_for('delete_slang_fact', region=region, fact_id=fact.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this fact?');">
                  <button type="submit" class="delete-btn">Delete</button>
                </form>
              </div>
            {% endif %}
          </div>
          <div class="fact-content">
            <p>{{ fact.content }}</p>
          </div>
          <div class="fact-footer">
            <small>
              {% if fact.is_system %}
                System fact
              {% else %}
                Added on {{ fact.created_at.strftime('%Y-%m-%d %H:%M') if fact.created_at else 'Recently' }}
              {% endif %}
            </small>
          </div>
        </div>
        {% endfor %}
      {% endif %}
      
      {% if user_facts %}
        <h3 class="facts-section-title" style="margin-top: 40px;">User Facts</h3>
        {% for fact in user_facts %}
        <div class="fact-card">
          <div class="fact-header">
            <h3>{{ fact.title }}</h3>
            {% if fact.user_id == session.get("user_id") %}
              <div class="fact-actions">
                <a href="{{ url_for('edit_slang_fact', region=region, fact_id=fact.id) }}" class="edit-btn">Edit</a>
                <form method="POST" action="{{ url_for('delete_slang_fact', region=region, fact_id=fact.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this fact?');">
                  <button type="submit" class="delete-btn">Delete</button>
                </form>
              </div>
            {% endif %}
          </div>
          <div class="fact-content">
            <p>{{ fact.content }}</p>
          </div>
          <div class="fact-footer">
            <small>Added on {{ fact.created_at.strftime('%Y-%m-%d %H:%M') if fact.created_at else 'Recently' }}</small>
          </div>
        </div>
        {% endfor %}
      {% endif %}
    {% else %}
      <p class="no-facts">No facts added yet. Be the first to share an interesting fact!</p>
    {% endif %}
  </div>
</div>
{% endblock %}


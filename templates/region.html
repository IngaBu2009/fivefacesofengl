{% extends "base.html" %}

{% block title %}
  {{ region.title | default('Region') }}
{% endblock %}

{% block content %}
  <h1>{{ region.title | default('Unknown Region') }}</h1>

  {% if region.sections %}
    {% for section in region.sections %}
      <h2>{{ section.title | default('Section') }}</h2>

      {% if section.content %}
        <p>{{ section.content }}</p>
      {% endif %}

      {% if section.table %}

        {% if region.title == "Diversity of words" %}
        <div class="diversity-page">
        {% endif %}

        <table>
          {% for row in section.table %}
            {% set row_index = loop.index0 %}
            <tr>
              {% for cell in row %}
                {% if loop.index0 == 0 %}
                  <td><strong>{{ cell }}</strong></td>
                {% else %}
                  {% set country = section.table[0][loop.index0] %}

                  {% if row_index >= 1 and cell and cell != "-" %}
                    {% set country_code = {
                      "USA": "us",
                      "UK": "uk",
                      "Canada": "ca",
                      "Australia": "au",
                      "New Zealand": "nz"
                    }[country] %}

                    {% set audio_id = (cell | lower | replace(" ", "-")) ~ "-" ~ country_code %}

                    <td>
                      {% if region.title == "Diversity of words" %}
                        <span
                          class="clickable-audio"
                          data-audio="{{ audio_id }}"
                        >
                          {{ cell }}
                        </span>
                      {% else %}
                        {{ cell }}
                      {% endif %}
                    </td>
                  {% else %}
                    <td>{{ cell }}</td>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </table>

        {% if region.title == "Diversity of words" %}
        </div>
        {% endif %}

      {% endif %}
    {% endfor %}
  {% else %}
    <p>No content available for this region.</p>
  {% endif %}
{% endblock %}

{% block extra_js %}

{% if region.title == "Diversity of words" %}

<!-- USA -->
<audio id="audio-candy-us" src="{{ url_for('static', filename='audio/candy-us.mp3') }}"></audio>
<audio id="audio-flip-flops-us" src="{{ url_for('static', filename='audio/flip-flops-us.mp3') }}"></audio>
<audio id="audio-sweater-us" src="{{ url_for('static', filename='audio/sweater-us.mp3') }}"></audio>
<audio id="audio-trash-can-us" src="{{ url_for('static', filename='audio/trash-can-us.mp3') }}"></audio>
<audio id="audio-sausage-us" src="{{ url_for('static', filename='audio/sausage-us.mp3') }}"></audio>
<audio id="audio-afternoon-us" src="{{ url_for('static', filename='audio/afternoon-us.mp3') }}"></audio>

<!-- UK -->
<audio id="audio-sweets-uk" src="{{ url_for('static', filename='audio/sweets-uk.mp3') }}"></audio>
<audio id="audio-flip-flops-uk" src="{{ url_for('static', filename='audio/flip-flops-uk.mp3') }}"></audio>
<audio id="audio-jumper-uk" src="{{ url_for('static', filename='audio/jumper-uk.mp3') }}"></audio>
<audio id="audio-bin-uk" src="{{ url_for('static', filename='audio/bin-uk.mp3') }}"></audio>
<audio id="audio-sausage-uk" src="{{ url_for('static', filename='audio/sausage-uk.mp3') }}"></audio>
<audio id="audio-afternoon-uk" src="{{ url_for('static', filename='audio/afternoon-uk.mp3') }}"></audio>

<!-- Canada -->
<audio id="audio-candy-ca" src="{{ url_for('static', filename='audio/candy-ca.mp3') }}"></audio>
<audio id="audio-flip-flops-ca" src="{{ url_for('static', filename='audio/flip-flops-ca.mp3') }}"></audio>
<audio id="audio-jumper-ca" src="{{ url_for('static', filename='audio/jumper-ca.mp3') }}"></audio>
<audio id="audio-bin-ca" src="{{ url_for('static', filename='audio/bin-ca.mp3') }}"></audio>
<audio id="audio-sausage-ca" src="{{ url_for('static', filename='audio/sausage-ca.mp3') }}"></audio>
<audio id="audio-afternoon-ca" src="{{ url_for('static', filename='audio/afternoon-ca.mp3') }}"></audio>

<!-- Australia -->
<audio id="audio-lollies-au" src="{{ url_for('static', filename='audio/lollies-au.mp3') }}"></audio>
<audio id="audio-thongs-au" src="{{ url_for('static', filename='audio/thongs-au.mp3') }}"></audio>
<audio id="audio-jumper-au" src="{{ url_for('static', filename='audio/jumper-au.mp3') }}"></audio>
<audio id="audio-bin-au" src="{{ url_for('static', filename='audio/bin-au.mp3') }}"></audio>
<audio id="audio-snag-au" src="{{ url_for('static', filename='audio/snag-au.mp3') }}"></audio>
<audio id="audio-arvo-au" src="{{ url_for('static', filename='audio/arvo-au.mp3') }}"></audio>

<!-- New Zealand -->
<audio id="audio-lollies-nz" src="{{ url_for('static', filename='audio/lollies-nz.mp3') }}"></audio>
<audio id="audio-jandals-nz" src="{{ url_for('static', filename='audio/jandals-nz.mp3') }}"></audio>
<audio id="audio-jumper-nz" src="{{ url_for('static', filename='audio/jumper-nz.mp3') }}"></audio>
<audio id="audio-rubbish-bin-nz" src="{{ url_for('static', filename='audio/rubbish-bin-nz.mp3') }}"></audio>
<audio id="audio-sausage-nz" src="{{ url_for('static', filename='audio/sausage-nz.mp3') }}"></audio>
<audio id="audio-arvo-nz" src="{{ url_for('static', filename='audio/arvo-nz.mp3') }}"></audio>

<script>
  let currentAudio = null;
  let currentWord = null;

  document.querySelectorAll('.diversity-page .clickable-audio').forEach(span => {
    span.addEventListener('click', function () {
      const audioId = this.dataset.audio;
      const audio = document.getElementById(`audio-${audioId}`);

      if (!audio) return;

      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      if (currentWord) {
        currentWord.classList.remove("playing");
      }

      currentAudio = audio;
      currentWord = this;

      this.classList.add("playing");
      audio.currentTime = 0;
      audio.play();

      audio.onended = () => {
        this.classList.remove("playing");
      };
    });
  });
</script>

{% endif %}
{% endblock %}

{% extends "base.html" %}

{% block content %}
<div class="test-container">
  <div class="test-header">
    <h1>What's your English dialect?</h1>
    <p class="test-subtitle">Answer a few questions to discover which English dialect matches your vocabulary!</p>
  </div>

  <div class="test-progress">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <p class="progress-text"><span id="currentQuestion">1</span> / <span id="totalQuestions">5</span></p>
  </div>

  <div id="test" class="test-wrapper">
    <div class="question active">
      <div class="question-number">Question 1</div>
      <h2 class="question-text">What do you call a sweet treat?</h2>
      <div class="options-grid">
        <button class="option-btn" onclick="answer('us')">
          <span class="option-label">Candy</span>
          <span class="option-hint">ğŸ‡ºğŸ‡¸ American</span>
        </button>
        <button class="option-btn" onclick="answer('uk')">
          <span class="option-label">Sweets</span>
          <span class="option-hint">ğŸ‡¬ğŸ‡§ British</span>
        </button>
        <button class="option-btn" onclick="answer('au')">
          <span class="option-label">Lollies</span>
          <span class="option-hint">ğŸ‡¦ğŸ‡º Australian</span>
        </button>
      </div>
    </div>

    <div class="question">
      <div class="question-number">Question 2</div>
      <h2 class="question-text">What do you call this? ğŸ—‘ï¸</h2>
      <div class="options-grid">
        <button class="option-btn" onclick="answer('us')">
          <span class="option-label">Trash can</span>
          <span class="option-hint">ğŸ‡ºğŸ‡¸ American</span>
        </button>
        <button class="option-btn" onclick="answer('uk')">
          <span class="option-label">Bin</span>
          <span class="option-hint">ğŸ‡¬ğŸ‡§ British</span>
        </button>
        <button class="option-btn" onclick="answer('au')">
          <span class="option-label">Rubbish bin</span>
          <span class="option-hint">ğŸ‡¦ğŸ‡º Australian</span>
        </button>
      </div>
    </div>

    <div class="question">
      <div class="question-number">Question 3</div>
      <h2 class="question-text">What do you wear when it's cold?</h2>
      <div class="options-grid">
        <button class="option-btn" onclick="answer('us')">
          <span class="option-label">Sweater</span>
          <span class="option-hint">ğŸ‡ºğŸ‡¸ American</span>
        </button>
        <button class="option-btn" onclick="answer('uk')">
          <span class="option-label">Jumper</span>
          <span class="option-hint">ğŸ‡¬ğŸ‡§ British</span>
        </button>
        <button class="option-btn" onclick="answer('ca')">
          <span class="option-label">Jumper</span>
          <span class="option-hint">ğŸ‡¨ğŸ‡¦ Canadian</span>
        </button>
      </div>
    </div>

    <div class="question">
      <div class="question-number">Question 4</div>
      <h2 class="question-text">How do you say "afternoon" informally?</h2>
      <div class="options-grid">
        <button class="option-btn" onclick="answer('au')">
          <span class="option-label">Arvo</span>
          <span class="option-hint">ğŸ‡¦ğŸ‡º Australian</span>
        </button>
        <button class="option-btn" onclick="answer('nz')">
          <span class="option-label">Arvo</span>
          <span class="option-hint">ğŸ‡³ğŸ‡¿ New Zealand</span>
        </button>
        <button class="option-btn" onclick="answer('us')">
          <span class="option-label">Afternoon</span>
          <span class="option-hint">ğŸ‡ºğŸ‡¸ American</span>
        </button>
      </div>
    </div>

    <div class="question">
      <div class="question-number">Question 5</div>
      <h2 class="question-text">What do you call flip-flops?</h2>
      <div class="options-grid">
        <button class="option-btn" onclick="answer('us')">
          <span class="option-label">Flip-flops</span>
          <span class="option-hint">ğŸ‡ºğŸ‡¸ American</span>
        </button>
        <button class="option-btn" onclick="answer('au')">
          <span class="option-label">Thongs</span>
          <span class="option-hint">ğŸ‡¦ğŸ‡º Australian</span>
        </button>
        <button class="option-btn" onclick="answer('nz')">
          <span class="option-label">Jandals</span>
          <span class="option-hint">ğŸ‡³ğŸ‡¿ New Zealand</span>
        </button>
      </div>
    </div>

    <div class="question result-question" id="result">
      <div class="result-content">
        <div class="result-icon">ğŸ¯</div>
        <h2 class="result-title">Your English Dialect Is:</h2>
        <div class="result-dialect" id="result-text"></div>
        <p class="result-description" id="result-description"></p>
        <button class="retry-btn" onclick="location.reload()">
          <span>ğŸ”„ Try Again</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  let current = 0;
  const questions = document.querySelectorAll(".question:not(.result-question)");
  const totalQuestions = questions.length;

  const score = {
    us: 0,
    uk: 0,
    au: 0,
    nz: 0,
    ca: 0
  };

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°
  document.addEventListener('DOMContentLoaded', function() {
    if (questions.length > 0) {
      questions[0].classList.add("active", "fade-in");
      updateProgress();
    }
  });

  function updateProgress() {
    const progress = ((current + 1) / totalQuestions) * 100;
    document.getElementById("progressFill").style.width = progress + "%";
    document.getElementById("currentQuestion").textContent = current + 1;
  }

  function answer(dialect) {
    score[dialect]++;

    // ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¸ÑÑ‡ĞµĞ·Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°
    const currentQuestionEl = document.querySelector(".question.active:not(.result-question)");
    if (currentQuestionEl) {
      currentQuestionEl.classList.add("fade-out");
      
      setTimeout(() => {
        currentQuestionEl.classList.remove("active", "fade-out", "fade-in");
        current++;

        if (current < totalQuestions) {
          questions[current].classList.add("active", "fade-in");
          updateProgress();
        } else {
          showResult();
        }
      }, 300);
    }
  }

  function showResult() {
    let winner = "us";
    let max = 0;

    for (let key in score) {
      if (score[key] > max) {
        max = score[key];
        winner = key;
      }
    }

    const results = {
      us: { name: "ğŸ‡ºğŸ‡¸ American English", desc: "You prefer American vocabulary! Words like 'candy', 'trash can', and 'sidewalk' are part of your everyday language." },
      uk: { name: "ğŸ‡¬ğŸ‡§ British English", desc: "You lean towards British English! You use terms like 'sweets', 'bin', and 'pavement' in your daily speech." },
      au: { name: "ğŸ‡¦ğŸ‡º Australian English", desc: "G'day! You favor Australian English! You're comfortable with 'lollies', 'thongs', and 'arvo'." },
      nz: { name: "ğŸ‡³ğŸ‡¿ New Zealand English", desc: "Sweet as! You prefer New Zealand English! Words like 'jandals' and 'dairy' are in your vocabulary." },
      ca: { name: "ğŸ‡¨ğŸ‡¦ Canadian English", desc: "Eh! You prefer Canadian English! You use terms like 'toque', 'washroom', and 'double-double'." }
    };

    const result = results[winner];
    document.getElementById("result-text").innerHTML = result.name;
    document.getElementById("result-description").innerText = result.desc;
    document.getElementById("result").classList.add("active", "fade-in");
    document.getElementById("progressFill").style.width = "100%";
    document.getElementById("currentQuestion").textContent = totalQuestions;
  }

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
  updateProgress();
</script>
{% endblock %}

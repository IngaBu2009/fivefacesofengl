{% extends "base.html" %}

{% block content %}
<div class="profile-page">
  <div class="profile-layout">

    <!-- SIDEBAR -->
    <aside class="profile-sidebar">
      <div class="avatar-container">
        {% if user.avatar_filename %}
          <img src="{{ url_for('uploaded_avatar', filename=user.avatar_filename) }}" alt="Avatar" class="avatar-img" id="avatarPreview">
        {% else %}
          <div class="avatar" id="avatarPreview"></div>
        {% endif %}
        <label for="avatar-input" class="avatar-upload-label">
          <span class="avatar-upload-icon">üì∑</span>
          <span class="avatar-upload-text">Change Photo</span>
        </label>
        <input type="file" id="avatar-input" name="avatar" accept="image/*" style="display: none;" onchange="previewAvatar(this)" form="profile-form">
      </div>

      <h2>{{ user.username }}</h2>
      <p class="profile-subtitle">English learner</p>

      <form method="post" id="profile-form" enctype="multipart/form-data">
        <label>Email</label>
        <input type="email" name="email" value="{{ user.email or '' }}">

        <label>Last name</label>
        <input type="text" name="last_name" value="{{ user.last_name or '' }}">

        <button class="save-btn" type="submit">Save profile</button>
      </form>
    </aside>

    <!-- MAIN -->
    <section class="profile-main">

      <div class="profile-card">
        <h3>üëÄ Interests</h3>
        <textarea name="interests" form="profile-form">{{ user.interests or '' }}</textarea>
      </div>

      <div class="profile-card">
        <h3>üìä Activity</h3>
        <p>Dialect tests completed: <strong>3</strong></p>
        <p>Words learned: <strong>42</strong></p>
      </div>

    </section>

  </div>
</div>

<script>
  function previewAvatar(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const preview = document.getElementById('avatarPreview');
        if (preview.tagName === 'IMG') {
          preview.src = e.target.result;
        } else {
          // –ï—Å–ª–∏ —ç—Ç–æ div, –∑–∞–º–µ–Ω—è–µ–º –µ–≥–æ –Ω–∞ img
          const img = document.createElement('img');
          img.id = 'avatarPreview';
          img.className = 'avatar-img';
          img.src = e.target.result;
          img.alt = 'Avatar';
          preview.parentNode.replaceChild(img, preview);
        }
      };
      
      reader.readAsDataURL(input.files[0]);
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
      document.getElementById('profile-form').submit();
    }
  }
</script>
{% endblock %}
